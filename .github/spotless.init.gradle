// Inject Spotless into each project and configure common formatters.
// This works with Gradle 8.x and Java 21 without modifying student files.

allprojects { Project p ->
    // Make the Spotless plugin available on the project's classpath
    buildscript {
        repositories {
            // Spotless plugin is available on the Gradle Plugin Portal and Maven Central
            maven { url = uri("https://plugins.gradle.org/m2/") }
            mavenCentral()
        }
        dependencies {
            classpath("com.diffplug.spotless:spotless-plugin-gradle:6.25.0")
        }
    }

    // Apply the plugin programmatically (works for Groovy or Kotlin DSL projects)
    pluginManager.apply("com.diffplug.spotless")

    // Configure Spotless for typical Android/Kotlin projects
    spotless {
        // Kotlin source
        kotlin {
            target("**/*.kt")
            targetExclude("**/build/**")
            ktlint("1.3.1")
            trimTrailingWhitespace()
            endWithNewline()
        }

        // Kotlin Gradle scripts
        kotlinGradle {
            target("**/*.gradle.kts")
            ktlint("1.3.1")
            trimTrailingWhitespace()
            endWithNewline()
        }

        // Java (if present)
        java {
            target("**/*.java")
            targetExclude("**/build/**")
            googleJavaFormat("1.17.0")
            trimTrailingWhitespace()
            endWithNewline()
        }

        // Misc text (optional)
        format("misc") {
            target("**/*.md", "**/*.xml", "**/*.yml", "**/*.yaml", "**/.gitignore", "**/.gitattributes")
            targetExclude("**/build/**", ".gradle/**")
            trimTrailingWhitespace()
            endWithNewline()
        }
    }
}